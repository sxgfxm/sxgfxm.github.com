
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>iOS Core Animation Advanced Techniques - Light's Blog</title>
  <meta name="author" content="Light">

  
  <meta name="description" content="iOS Core Animation Advanced Techniques">
  <meta name="keywords" content="sxgfxm,CALayer,UIView,Core Animation">

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://sxgfxm.github.io/blog/2017/02/20/ios-core-animation-advanced-techniques/">
  <link href="/favicon.png" rel="icon">
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <link href="/atom.xml" rel="alternate" title="Light's Blog" type="application/atom+xml">
  <script src="/javascripts/modernizr-2.0.js"></script>
  <script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
  <script>!window.jQuery && document.write(unescape('%3Cscript src="/javascripts/libs/jquery.min.js"%3E%3C/script%3E'))</script>
  <script src="/javascripts/octopress.js" type="text/javascript"></script>
  <!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<link href="//fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href="//fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<script type="text/javascript">

function addBlankTargetForLinks () {

  $('a[href^="http"]').each(function(){

      $(this).attr('target', '_blank');

  });

}

$(document).bind('DOMNodeInserted', function(event) {

  addBlankTargetForLinks();

});

</script>


  
  <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-86198628-1']);
    _gaq.push(['_trackPageview']);

    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
  </script>


  
  <meta name="baidu-site-verification" content="vgau9BNOtE" />
</head>

<body   >
  <header role="banner"><hgroup>
  <h1><a href="/">Light's Blog</a></h1>
  
    <h2>The best or nothing.</h2>
  
</hgroup>

</header>
  <nav role="navigation"><ul class="subscription" data-subscription="rss">
  <li><a href="/atom.xml" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
  
</ul>
  
<form action="https://www.google.com/search" method="get">
  <fieldset role="search">
    <!-- <input type="hidden" name="sitesearch" value="sxgfxm.github.io"> -->
    <input class="search" type="text" name="q" results="0" placeholder="Search"/>
  </fieldset>
</form>
  
<ul class="main-navigation">
  <li><a href="/">Blog</a></li>
  <li><a href="/blog/archives">Archives</a></li>
</ul>

</nav>
  <div id="main">
    <div id="content">
      <div>
<article class="hentry" role="article">
  
  <header>
    
      <h1 class="entry-title">iOS Core Animation Advanced Techniques</h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2017-02-20T22:10:40+08:00'><span class='date'><span class='date-month'>Feb</span> <span class='date-day'>20</span><span class='date-suffix'>th</span>, <span class='date-year'>2017</span></span> <span class='time'>10:10 pm</span></time>
        
           | <a href="#disqus_thread"
             data-disqus-identifier="http://sxgfxm.github.io">Comments</a>
        
      </p>
    
  </header>


<div class="entry-content"><h1>Introduction</h1>

<p>本文主要为<strong>iOS Core Animation Advanced Techniques</strong>的笔记。</p>

<!--more-->


<h2>CALayer和UIView</h2>

<p>1.CALayer和UIView有什么关系？<br/>
UIView是对CALayer的封装，可以处理touch事件。<br/>
UIView是通过CALayer显示的。<br/>
UIView会自动重绘，CALayer需要手动重绘。<br/>
UIView是二维的，CALayer是三维的。<br/>
UIView支持autoLayout，CALayer不支持autoLayout。<br/>
2、CALayer的特性是什么？<br/>
可以绘制阴影、圆角、彩色边框；<br/>
可以处理3D变换；<br/>
可以处理非矩形边界；<br/>
可以处理透明遮罩；<br/>
可以处理多级非线性动画。<br/>
3、什么情况下会使用CALayer？<br/>
开发跨平台应用；<br/>
与特殊图层打交道；<br/>
提高性能。<br/>
4、为什么不把CALayer和UIView合二为一，而是有两套并列的层次结构？<br/>
把绘图和事件处理分离，是为了减少重复的代码。<br/>
在Mac OS上已经有CALayer，但在iPhone和Mac的交互是有本质不同的，所以UIView来处理。</p>

<h3>Contents</h3>

<p>1、如何让UIView等比清晰显示图片的右上角？<br/>
<code>layer.contents = (__bridge id)image.CGImage;</code><br/>
<code>layer.contentsGravity = kCAGravityResizeAspect;</code><br/>
<code>layer.contentsScale = [UIScreen mainScreen].scale;</code><br/>
<code>layer.contentsRect = CGRectMake(0.5,0,0.5,0.5);</code><br/>
2、-drawRect:方法的作用是什么？空的-drawRect:方法有何影响？<br/>
UIView自定义绘图。<br/>
如果自己实现-drawRect:方法，会为view创建一个backing image。<br/>
3、如何绘制带阴影的有裁剪效果的UIView？<br/>
设置layer阴影；<br/>
通过layer代理绘图；</p>

<h3>Geometry</h3>

<p>1、center, position的区别？<br/>
center对应view；position对应layer。<br/>
两者都表示anchorPoint在父视图中的位置。<br/>
因为UIView并没有暴露anchorPoint属性，所以被称作center。<br/>
2、anchorPoint理解？<br/>
控制点。<br/>
3、frame的理解？<br/>
是否可以改变view的frame而不改变layer的frame。<br/>
frame是由bounds，position和transform计算而来的。<br/>
4、坐标转换？</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='objective-c'><span class='line'><span class="p">-</span> <span class="p">(</span><span class="bp">CGPoint</span><span class="p">)</span><span class="nf">convertPoint:</span><span class="p">(</span><span class="bp">CGPoint</span><span class="p">)</span><span class="nv">point</span> <span class="nf">fromLayer:</span><span class="p">(</span><span class="bp">CALayer</span> <span class="o">*</span><span class="p">)</span><span class="nv">layer</span><span class="p">;</span>
</span><span class='line'><span class="p">-</span> <span class="p">(</span><span class="bp">CGPoint</span><span class="p">)</span><span class="nf">convertPoint:</span><span class="p">(</span><span class="bp">CGPoint</span><span class="p">)</span><span class="nv">point</span> <span class="nf">toLayer:</span><span class="p">(</span><span class="bp">CALayer</span> <span class="o">*</span><span class="p">)</span><span class="nv">layer</span><span class="p">;</span>
</span><span class='line'><span class="p">-</span> <span class="p">(</span><span class="bp">CGRect</span><span class="p">)</span><span class="nf">convertRect:</span><span class="p">(</span><span class="bp">CGRect</span><span class="p">)</span><span class="nv">rect</span> <span class="nf">fromLayer:</span><span class="p">(</span><span class="bp">CALayer</span> <span class="o">*</span><span class="p">)</span><span class="nv">layer</span><span class="p">;</span>
</span><span class='line'><span class="p">-</span> <span class="p">(</span><span class="bp">CGRect</span><span class="p">)</span><span class="nf">convertRect:</span><span class="p">(</span><span class="bp">CGRect</span><span class="p">)</span><span class="nv">rect</span> <span class="nf">toLayer:</span><span class="p">(</span><span class="bp">CALayer</span> <span class="o">*</span><span class="p">)</span><span class="nv">layer</span><span class="p">;</span>
</span></code></pre></td></tr></table></div></figure>


<p>5、坐标翻转</p>

<p><code>layer.geometryFlipped = YES;</code></p>

<p>6、如何在不修改layer层次结构的情况下，使下层的layer在顶层显示？<br/>
zPosition，用来改变layer的显示层次；<br/>
zAnchorPoint?<br/>
7、如何用CALayer实现touch handling？<br/>
-containsPoint:<br/>
-hitTest: 严格按照layer tree的层次结构判断，与zPosition无关。<br/>
8、如何实现CALayer的自动布局？<br/>
<code>- (void)layoutSublayersOfLayer:(CALayer *)layer;</code>，<br/>
当bounds改变或调用<code>-setNeedsLayout</code>时触发。</p>

<h3>Visual Effects</h3>

<p>1、如何实现圆角？曲率不同的圆角？</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='objective-c'><span class='line'><span class="n">layer</span><span class="p">.</span><span class="n">cornerRadius</span> <span class="o">=</span> <span class="mf">5.0f</span><span class="p">;</span>
</span><span class='line'><span class="n">layer</span><span class="p">.</span><span class="n">maskToBounds</span> <span class="o">=</span> <span class="nb">YES</span><span class="p">;</span>
</span></code></pre></td></tr></table></div></figure>


<p>2、如何实现彩色边框？</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='objective-c'><span class='line'><span class="n">layer</span><span class="p">.</span><span class="n">borderWidth</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
</span><span class='line'><span class="n">layer</span><span class="p">.</span><span class="n">borderColor</span> <span class="o">=</span> <span class="p">[</span><span class="bp">UIColor</span> <span class="n">redColor</span><span class="p">].</span><span class="bp">CGColor</span><span class="p">;</span>
</span></code></pre></td></tr></table></div></figure>


<p>border只与bounds相关。<br/>
3、如何添加阴影？</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='objective-c'><span class='line'><span class="n">layer</span><span class="p">.</span><span class="n">shadowOpacity</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
</span><span class='line'><span class="n">layer</span><span class="p">.</span><span class="n">shadowColor</span> <span class="o">=</span> <span class="p">[</span><span class="bp">UIColor</span> <span class="n">redColor</span><span class="p">].</span><span class="bp">CGColor</span><span class="p">;</span>
</span><span class='line'><span class="n">layer</span><span class="p">.</span><span class="n">shadowOffset</span> <span class="o">=</span> <span class="n">CGSizeMake</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">);</span>
</span><span class='line'><span class="n">layer</span><span class="p">.</span><span class="n">shadowRadius</span> <span class="o">=</span> <span class="mi">5</span><span class="p">;</span>
</span></code></pre></td></tr></table></div></figure>


<p>shadow与形状有关。<br/>
如何添加maskToBounds = YES时的阴影？<br/>
两层。<br/>
如何绘制不规则阴影？<br/>
<code>layer.shadowPath = path;</code>
4、不规则裁剪，动态裁剪<br/>
<code>layer.mask = maskLayer;</code>
5、scaling filter<br/>
kCAFilterNearest，适用于无对角线，对比明显的图片，保留像素，像素图；<br/>
kCAFilterLinear，适用于复杂图片，保留轮廓；<br/>
6、group opacity<br/>
opacity作用于层次结构，0.5+0.5 = 0.75<br/>
UIViewGroupOpacity = YES，Info.plist，降低性能。<br/>
<code>layer.shouldRasterize = YES</code>，在渲染前合成一张图片，防止alpha值影响。<br/>
<code>layer.rasterizationScale = [UIScreen mainScreen].scale;</code></p>

<h3>Transform</h3>

<p>1、Affine Transforms，仿射变换<br/>
CGAffineTransform，用来表示二维旋转，缩放和变换。对一个2D点做2D变换。<br/>
它是一个3行2列的矩阵。<br/>
做运算时需要扩展。<br/>
变换前平行的线，变换后依然平行。<br/>
2、创建仿射变换</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='objective-c'><span class='line'><span class="n">CGAffineTransformMakeRotation</span><span class="p">(</span><span class="n">CGFloat</span> <span class="n">angle</span><span class="p">);</span>
</span><span class='line'><span class="n">CGAffineTransformMakeScale</span><span class="p">(</span><span class="n">CGFloat</span> <span class="n">sx</span><span class="p">,</span> <span class="n">CGFloat</span> <span class="n">sy</span><span class="p">);</span>
</span><span class='line'><span class="n">CGAffineTransformMakeTranslation</span><span class="p">(</span><span class="n">CGFloat</span> <span class="n">tx</span><span class="p">,</span> <span class="n">CGFloat</span> <span class="n">ty</span><span class="p">);</span>
</span></code></pre></td></tr></table></div></figure>


<p>角度弧度转换</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='objective-c'><span class='line'><span class="cp">#define RADIANS_TO_DEGREES(x) ((x)/M_PI*180.0)</span>
</span><span class='line'><span class="cp">#define DEGREES_TO_RADIANS(x) ((x)/180.0*M_PI)</span>
</span></code></pre></td></tr></table></div></figure>


<p>3、连续变换</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='objective-c'><span class='line'><span class="n">CGAffineTransformRotate</span><span class="p">(</span><span class="bp">CGAffineTransform</span> <span class="n">t</span><span class="p">,</span> <span class="n">CGFloat</span> <span class="n">angle</span><span class="p">);</span>
</span><span class='line'><span class="n">CGAffineTransformScale</span><span class="p">(</span><span class="bp">CGAffineTransform</span> <span class="n">t</span><span class="p">,</span> <span class="n">CGFloat</span> <span class="n">sx</span><span class="p">,</span> <span class="n">CGFloat</span> <span class="n">sy</span><span class="p">);</span>
</span><span class='line'><span class="n">CGAffineTransformTranslate</span><span class="p">(</span><span class="bp">CGAffineTransform</span> <span class="n">t</span><span class="p">,</span> <span class="n">CGFloat</span> <span class="n">tx</span><span class="p">,</span> <span class="n">CGFloat</span> <span class="n">ty</span><span class="p">);</span>
</span><span class='line'><span class="err">或</span>
</span><span class='line'><span class="n">CGAffineTransformConcat</span><span class="p">(</span><span class="bp">CGAffineTransform</span> <span class="n">t1</span><span class="p">,</span> <span class="bp">CGAffineTransform</span> <span class="n">t2</span><span class="p">);</span>
</span></code></pre></td></tr></table></div></figure>


<p>单位矩阵，CGAffineTransformIdentity。<br/>
变换顺序不同，结果不同。因为矩阵运算不符合交换律。<br/>
4、shear变换</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='objective-c'><span class='line'><span class="bp">CGAffineTransform</span> <span class="nf">CGAffineTransformMakeShear</span><span class="p">(</span><span class="n">CGFloat</span> <span class="n">x</span><span class="p">,</span> <span class="n">CGFloat</span> <span class="n">y</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>  <span class="bp">CGAffineTransform</span> <span class="n">transform</span> <span class="o">=</span> <span class="n">CGAffineTransformIdentity</span><span class="p">;</span> <span class="n">transform</span><span class="p">.</span><span class="n">c</span> <span class="o">=</span> <span class="o">-</span><span class="n">x</span><span class="p">;</span>
</span><span class='line'>  <span class="n">transform</span><span class="p">.</span><span class="n">b</span> <span class="o">=</span> <span class="n">y</span><span class="p">;</span>
</span><span class='line'>  <span class="k">return</span> <span class="n">transform</span><span class="p">;</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>5、3D Transform，3D变换<br/>
CATransform3D，是一个4行4列的矩阵。对一个3D点做3D变换。</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='objective-c'><span class='line'><span class="n">CATransform3DMakeRotation</span><span class="p">(</span><span class="n">CGFloat</span> <span class="n">angle</span><span class="p">,</span> <span class="n">CGFloat</span> <span class="n">x</span><span class="p">,</span> <span class="n">CGFloat</span> <span class="n">y</span><span class="p">,</span> <span class="n">CGFloat</span> <span class="n">z</span><span class="p">);</span>
</span><span class='line'><span class="n">CATransform3DMakeScale</span><span class="p">(</span><span class="n">CGFloat</span> <span class="n">sx</span><span class="p">,</span> <span class="n">CGFloat</span> <span class="n">sy</span><span class="p">,</span> <span class="n">CGFloat</span> <span class="n">sz</span><span class="p">);</span>
</span><span class='line'><span class="n">CATransform3DMakeTranslation</span><span class="p">(</span><span class="n">Gloat</span> <span class="n">tx</span><span class="p">,</span> <span class="n">CGFloat</span> <span class="n">ty</span><span class="p">,</span> <span class="n">CGFloat</span> <span class="n">tz</span><span class="p">);</span>
</span></code></pre></td></tr></table></div></figure>


<p>6、Perspective Projection，透视<br/>
矩阵中m34的值用来设置透视，值越小透视约明显，值越大透视越不明显。<br/>
7、The Vanishing Point，消失点<br/>
定义消失点为anchorPoint。<br/>
8、sublayer共享透视视角<br/>
设置sublayerTransform<br/>
9、Backfaces，<br/>
layer是两面都有的。可以设置取消。</p>

<h2>Specialized Layers</h2>

<h3>CAShapeLayer</h3>

<p>CAShapeLayer比Core Graphics效率更高，硬件加速；<br/>
CAShapeLayer节省内存空间，不会创建backing image；<br/>
CAShapeLayer不会受bounds限制，Core Graphics不行；<br/>
CAShapeLayer不会变换后不会像素化。<br/>
基本使用方法：</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class='objective-c'><span class='line'><span class="bp">CAShapeLayer</span> <span class="o">*</span><span class="n">shapeLayer</span> <span class="o">=</span> <span class="p">[</span><span class="bp">CAShapeLayer</span> <span class="n">layer</span><span class="p">];</span>
</span><span class='line'><span class="n">shapeLayer</span><span class="p">.</span><span class="n">strokeColor</span> <span class="o">=</span> <span class="p">[</span><span class="bp">UIColor</span> <span class="n">redColor</span><span class="p">].</span><span class="bp">CGColor</span><span class="p">;</span>
</span><span class='line'><span class="n">shapeLayer</span><span class="p">.</span><span class="n">fillColor</span> <span class="o">=</span> <span class="p">[</span><span class="bp">UIColor</span> <span class="n">clearColor</span><span class="p">].</span><span class="bp">CGColor</span><span class="p">;</span>
</span><span class='line'><span class="n">shapeLayer</span><span class="p">.</span><span class="n">lineWidth</span> <span class="o">=</span> <span class="mi">5</span><span class="p">;</span>
</span><span class='line'><span class="n">shapeLayer</span><span class="p">.</span><span class="n">lineJoin</span> <span class="o">=</span> <span class="n">kCALineJoinRound</span><span class="p">;</span>
</span><span class='line'><span class="n">shapeLayer</span><span class="p">.</span><span class="n">lineCap</span> <span class="o">=</span> <span class="n">kCALineCapRound</span><span class="p">;</span>
</span><span class='line'><span class="n">shapeLayer</span><span class="p">.</span><span class="n">path</span> <span class="o">=</span> <span class="n">path</span><span class="p">.</span><span class="bp">CGPath</span><span class="p">;</span>
</span></code></pre></td></tr></table></div></figure>


<h3>CATextLayer</h3>

<p>UILabel，通过layer代理方法使用CG绘制string。<br/>
CATextLayer，用于显示文字，特效，效率比UILabel高。<br/>
基本使用方法：</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
</pre></td><td class='code'><pre><code class='objective-c'><span class='line'><span class="c1">//set text attributes</span>
</span><span class='line'><span class="n">textLayer</span><span class="p">.</span><span class="n">foregroundColor</span> <span class="o">=</span> <span class="p">[</span><span class="bp">UIColor</span> <span class="n">blackColor</span><span class="p">].</span><span class="bp">CGColor</span><span class="p">;</span>
</span><span class='line'><span class="n">textLayer</span><span class="p">.</span><span class="n">alignmentMode</span> <span class="o">=</span> <span class="n">kCAAlignmentJustified</span><span class="p">;</span>
</span><span class='line'><span class="n">textLayer</span><span class="p">.</span><span class="n">wrapped</span> <span class="o">=</span> <span class="nb">YES</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'><span class="c1">//choose a font</span>
</span><span class='line'><span class="bp">UIFont</span> <span class="o">*</span><span class="n">font</span> <span class="o">=</span> <span class="p">[</span><span class="bp">UIFont</span> <span class="nl">systemFontOfSize</span><span class="p">:</span><span class="mi">15</span><span class="p">];</span>
</span><span class='line'>
</span><span class='line'><span class="c1">//set layer font</span>
</span><span class='line'><span class="n">CFStringRef</span> <span class="n">fontName</span> <span class="o">=</span> <span class="p">(</span><span class="k">__bridge</span> <span class="n">CFStringRef</span><span class="p">)</span><span class="n">font</span><span class="p">.</span><span class="n">fontName</span><span class="p">;</span>
</span><span class='line'><span class="n">CGFontRef</span> <span class="n">fontRef</span> <span class="o">=</span> <span class="n">CGFontCreateWithFontName</span><span class="p">(</span><span class="n">fontName</span><span class="p">);</span>
</span><span class='line'><span class="n">textLayer</span><span class="p">.</span><span class="n">font</span> <span class="o">=</span> <span class="n">fontRef</span><span class="p">;</span>
</span><span class='line'><span class="n">textLayer</span><span class="p">.</span><span class="n">fontSize</span> <span class="o">=</span> <span class="n">font</span><span class="p">.</span><span class="n">pointSize</span><span class="p">;</span>
</span><span class='line'><span class="n">CGFontRelease</span><span class="p">(</span><span class="n">fontRef</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'><span class="c1">//text</span>
</span><span class='line'><span class="n">textLayer</span><span class="p">.</span><span class="n">string</span> <span class="o">=</span> <span class="s">@&quot;Text&quot;</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'><span class="c1">//scale</span>
</span><span class='line'><span class="n">textLayer</span><span class="p">.</span><span class="n">contentsScale</span> <span class="o">=</span> <span class="p">[</span><span class="bp">UIScreen</span> <span class="n">mainScreen</span><span class="p">].</span><span class="n">scale</span><span class="p">;</span>
</span></code></pre></td></tr></table></div></figure>


<p>富文本：</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
</pre></td><td class='code'><pre><code class='objective-c'><span class='line'><span class="c1">//create attributed string</span>
</span><span class='line'><span class="bp">NSMutableAttributedString</span> <span class="o">*</span><span class="n">string</span> <span class="o">=</span> <span class="nb">nil</span><span class="p">;</span>
</span><span class='line'><span class="n">string</span> <span class="o">=</span> <span class="p">[[</span><span class="bp">NSMutableAttributedString</span> <span class="n">alloc</span><span class="p">]</span> <span class="nl">initWithString</span><span class="p">:</span><span class="n">text</span><span class="p">];</span>
</span><span class='line'>
</span><span class='line'><span class="c1">//convert UIFont to a CTFont</span>
</span><span class='line'><span class="n">CFStringRef</span> <span class="n">fontName</span> <span class="o">=</span> <span class="p">(</span><span class="k">__bridge</span> <span class="n">CFStringRef</span><span class="p">)</span><span class="n">font</span><span class="p">.</span><span class="n">fontName</span><span class="p">;</span> <span class="n">CGFloat</span> <span class="n">fontSize</span> <span class="o">=</span> <span class="n">font</span><span class="p">.</span><span class="n">pointSize</span><span class="p">;</span>
</span><span class='line'><span class="n">CTFontRef</span> <span class="n">fontRef</span> <span class="o">=</span> <span class="n">CTFontCreateWithName</span><span class="p">(</span><span class="n">fontName</span><span class="p">,</span> <span class="n">fontSize</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'><span class="c1">//set text attributes</span>
</span><span class='line'><span class="bp">NSDictionary</span> <span class="o">*</span><span class="n">attribs</span> <span class="o">=</span> <span class="l">@{</span>
</span><span class='line'>  <span class="p">(</span><span class="k">__bridge</span> <span class="kt">id</span><span class="p">)</span><span class="nl">kCTForegroundColorAttributeName</span><span class="p">:(</span><span class="k">__bridge</span> <span class="kt">id</span><span class="p">)[</span><span class="bp">UIColor</span> <span class="n">blackColor</span><span class="p">].</span><span class="bp">CGColor</span><span class="p">,</span>
</span><span class='line'>  <span class="p">(</span><span class="k">__bridge</span> <span class="kt">id</span><span class="p">)</span><span class="nl">kCTFontAttributeName</span><span class="p">:</span> <span class="p">(</span><span class="k">__bridge</span> <span class="kt">id</span><span class="p">)</span><span class="n">fontRef</span>
</span><span class='line'><span class="l">}</span><span class="p">;</span>
</span><span class='line'><span class="p">[</span><span class="n">string</span> <span class="nl">setAttributes</span><span class="p">:</span><span class="n">attribs</span> <span class="nl">range</span><span class="p">:</span><span class="n">NSMakeRange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="p">[</span><span class="n">text</span> <span class="n">length</span><span class="p">])];</span>
</span><span class='line'><span class="n">attribs</span> <span class="o">=</span> <span class="l">@{</span>
</span><span class='line'>  <span class="p">(</span><span class="k">__bridge</span> <span class="kt">id</span><span class="p">)</span><span class="nl">kCTForegroundColorAttributeName</span><span class="p">:</span> <span class="p">(</span><span class="k">__bridge</span> <span class="kt">id</span><span class="p">)[</span><span class="bp">UIColor</span> <span class="n">redColor</span><span class="p">].</span><span class="bp">CGColor</span><span class="p">,</span>
</span><span class='line'>  <span class="p">(</span><span class="k">__bridge</span> <span class="kt">id</span><span class="p">)</span><span class="nl">kCTUnderlineStyleAttributeName</span><span class="p">:</span> <span class="l">@(</span><span class="n">kCTUnderlineStyleSingle</span><span class="l">)</span><span class="p">,</span>
</span><span class='line'>  <span class="p">(</span><span class="k">__bridge</span> <span class="kt">id</span><span class="p">)</span><span class="nl">kCTFontAttributeName</span><span class="p">:</span> <span class="p">(</span><span class="k">__bridge</span> <span class="kt">id</span><span class="p">)</span><span class="n">fontRef</span>
</span><span class='line'><span class="l">}</span><span class="p">;</span>
</span><span class='line'><span class="p">[</span><span class="n">string</span> <span class="nl">setAttributes</span><span class="p">:</span><span class="n">attribs</span> <span class="nl">range</span><span class="p">:</span><span class="n">NSMakeRange</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="mi">5</span><span class="p">)];</span>
</span><span class='line'>
</span><span class='line'><span class="c1">//release the CTFont we created earlier</span>
</span><span class='line'><span class="n">CFRelease</span><span class="p">(</span><span class="n">fontRef</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'><span class="c1">//set layer text</span>
</span><span class='line'><span class="n">textLayer</span><span class="p">.</span><span class="n">string</span> <span class="o">=</span> <span class="n">string</span><span class="p">;</span>
</span></code></pre></td></tr></table></div></figure>


<p>修改view的根layer。</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class='objective-c'><span class='line'><span class="p">+</span> <span class="p">(</span><span class="kt">Class</span><span class="p">)</span><span class="nf">layerClass</span> <span class="p">{</span>
</span><span class='line'>  <span class="c1">//this makes our label create a CATextLayer</span>
</span><span class='line'>  <span class="c1">//instead of a regular CALayer for its backing layer</span>
</span><span class='line'>  <span class="k">return</span> <span class="p">[</span><span class="bp">CATextLayer</span> <span class="k">class</span><span class="p">];</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'><span class="p">-</span> <span class="p">(</span><span class="bp">CATextLayer</span> <span class="o">*</span><span class="p">)</span><span class="nf">textLayer</span> <span class="p">{</span>
</span><span class='line'>  <span class="k">return</span> <span class="p">(</span><span class="bp">CATextLayer</span> <span class="o">*</span><span class="p">)</span><span class="nb">self</span><span class="p">.</span><span class="n">layer</span><span class="p">;</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<h3>CATransformLayer</h3>

<p>保存变换后的layer</p>

<h3>CAGradientLayer</h3>

<p>用于绘制渐变层。<br/>
线性渐变。</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
</pre></td><td class='code'><pre><code class='objective-c'><span class='line'><span class="c1">//create gradient layer and add it to our container view</span>
</span><span class='line'><span class="bp">CAGradientLayer</span> <span class="o">*</span><span class="n">gradientLayer</span> <span class="o">=</span> <span class="p">[</span><span class="bp">CAGradientLayer</span> <span class="n">layer</span><span class="p">];</span>
</span><span class='line'><span class="n">gradientLayer</span><span class="p">.</span><span class="n">frame</span> <span class="o">=</span> <span class="nb">self</span><span class="p">.</span><span class="n">containerView</span><span class="p">.</span><span class="n">bounds</span><span class="p">;</span>
</span><span class='line'><span class="p">[</span><span class="nb">self</span><span class="p">.</span><span class="n">containerView</span><span class="p">.</span><span class="n">layer</span> <span class="nl">addSublayer</span><span class="p">:</span><span class="n">gradientLayer</span><span class="p">];</span>
</span><span class='line'>
</span><span class='line'><span class="c1">//set gradient colors</span>
</span><span class='line'><span class="n">gradientLayer</span><span class="p">.</span><span class="n">colors</span> <span class="o">=</span> <span class="l">@[</span>
</span><span class='line'>  <span class="p">(</span><span class="k">__bridge</span> <span class="kt">id</span><span class="p">)[</span><span class="bp">UIColor</span> <span class="n">redColor</span><span class="p">].</span><span class="bp">CGColor</span><span class="p">,</span>
</span><span class='line'>  <span class="p">(</span><span class="k">__bridge</span> <span class="kt">id</span><span class="p">)[</span><span class="bp">UIColor</span> <span class="n">blueColor</span><span class="p">].</span><span class="bp">CGColor</span><span class="p">,</span>
</span><span class='line'>  <span class="p">(</span><span class="k">__bridge</span> <span class="kt">id</span><span class="p">)[</span><span class="bp">UIColor</span> <span class="n">greenColor</span><span class="p">].</span><span class="bp">CGColor</span>
</span><span class='line'><span class="l">]</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'><span class="c1">//set locations</span>
</span><span class='line'><span class="n">gradientLayer</span><span class="p">.</span><span class="n">locations</span> <span class="o">=</span> <span class="l">@[</span><span class="mf">@0.0</span><span class="p">,</span> <span class="mf">@0.25</span><span class="p">,</span> <span class="mf">@0.5</span><span class="l">]</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'><span class="c1">//set gradient start and end points</span>
</span><span class='line'><span class="n">gradientLayer</span><span class="p">.</span><span class="n">startPoint</span> <span class="o">=</span> <span class="n">CGPointMake</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
</span><span class='line'><span class="n">gradientLayer</span><span class="p">.</span><span class="n">endPoint</span> <span class="o">=</span> <span class="n">CGPointMake</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
</span></code></pre></td></tr></table></div></figure>


<p>放射性渐变。</p>

<h3>CAReplicatorLayer</h3>

<p>用于高效绘制相似的layer。</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
</pre></td><td class='code'><pre><code class='objective-c'><span class='line'><span class="c1">//create a replicator layer and add it to our view</span>
</span><span class='line'><span class="bp">CAReplicatorLayer</span> <span class="o">*</span><span class="n">replicator</span> <span class="o">=</span> <span class="p">[</span><span class="bp">CAReplicatorLayer</span> <span class="n">layer</span><span class="p">];</span>
</span><span class='line'><span class="n">replicator</span><span class="p">.</span><span class="n">frame</span> <span class="o">=</span> <span class="nb">self</span><span class="p">.</span><span class="n">containerView</span><span class="p">.</span><span class="n">bounds</span><span class="p">;</span>
</span><span class='line'><span class="p">[</span><span class="nb">self</span><span class="p">.</span><span class="n">containerView</span><span class="p">.</span><span class="n">layer</span> <span class="nl">addSublayer</span><span class="p">:</span><span class="n">replicator</span><span class="p">];</span>
</span><span class='line'>
</span><span class='line'><span class="c1">//configure the replicator</span>
</span><span class='line'><span class="n">replicator</span><span class="p">.</span><span class="n">instanceCount</span> <span class="o">=</span> <span class="mi">10</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'><span class="c1">//apply a transform for each instance</span>
</span><span class='line'><span class="bp">CATransform3D</span> <span class="n">transform</span> <span class="o">=</span> <span class="n">CATransform3DIdentity</span><span class="p">;</span>
</span><span class='line'><span class="n">transform</span> <span class="o">=</span> <span class="n">CATransform3DTranslate</span><span class="p">(</span><span class="n">transform</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">200</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
</span><span class='line'><span class="n">transform</span> <span class="o">=</span> <span class="n">CATransform3DRotate</span><span class="p">(</span><span class="n">transform</span><span class="p">,</span> <span class="n">M_PI</span> <span class="o">/</span> <span class="mf">5.0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
</span><span class='line'><span class="n">transform</span> <span class="o">=</span> <span class="n">CATransform3DTranslate</span><span class="p">(</span><span class="n">transform</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="mi">200</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
</span><span class='line'><span class="n">replicator</span><span class="p">.</span><span class="n">instanceTransform</span> <span class="o">=</span> <span class="n">transform</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'><span class="c1">//apply a color shift for each instance</span>
</span><span class='line'><span class="n">replicator</span><span class="p">.</span><span class="n">instanceBlueOffset</span> <span class="o">=</span> <span class="o">-</span><span class="mf">0.1</span><span class="p">;</span>
</span><span class='line'><span class="n">replicator</span><span class="p">.</span><span class="n">instanceGreenOffset</span> <span class="o">=</span> <span class="o">-</span><span class="mf">0.1</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'><span class="c1">//create a sublayer and place it inside the replicator</span>
</span><span class='line'><span class="bp">CALayer</span> <span class="o">*</span><span class="n">layer</span> <span class="o">=</span> <span class="p">[</span><span class="bp">CALayer</span> <span class="n">layer</span><span class="p">];</span>
</span><span class='line'><span class="n">layer</span><span class="p">.</span><span class="n">frame</span> <span class="o">=</span> <span class="n">CGRectMake</span><span class="p">(</span><span class="mf">100.0f</span><span class="p">,</span> <span class="mf">100.0f</span><span class="p">,</span> <span class="mf">100.0f</span><span class="p">,</span> <span class="mf">100.0f</span><span class="p">);</span>
</span><span class='line'><span class="n">layer</span><span class="p">.</span><span class="n">backgroundColor</span> <span class="o">=</span> <span class="p">[</span><span class="bp">UIColor</span> <span class="n">whiteColor</span><span class="p">].</span><span class="bp">CGColor</span><span class="p">;</span>
</span><span class='line'><span class="p">[</span><span class="n">replicator</span> <span class="nl">addSublayer</span><span class="p">:</span><span class="n">layer</span><span class="p">];</span>
</span></code></pre></td></tr></table></div></figure>


<p>绘制镜面</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
</pre></td><td class='code'><pre><code class='objective-c'><span class='line'><span class="p">+</span> <span class="p">(</span><span class="kt">Class</span><span class="p">)</span><span class="nf">layerClass</span> <span class="p">{</span>
</span><span class='line'>  <span class="k">return</span> <span class="p">[</span><span class="bp">CAReplicatorLayer</span> <span class="k">class</span><span class="p">];</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'><span class="p">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="nf">setUp</span> <span class="p">{</span>
</span><span class='line'>  <span class="c1">//configure replicator</span>
</span><span class='line'>  <span class="bp">CAReplicatorLayer</span> <span class="o">*</span><span class="n">layer</span> <span class="o">=</span> <span class="p">(</span><span class="bp">CAReplicatorLayer</span> <span class="o">*</span><span class="p">)</span><span class="nb">self</span><span class="p">.</span><span class="n">layer</span><span class="p">;</span>
</span><span class='line'>  <span class="n">layer</span><span class="p">.</span><span class="n">instanceCount</span> <span class="o">=</span> <span class="mi">2</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>  <span class="c1">//move reflection instance below original and flip vertically</span>
</span><span class='line'>  <span class="bp">CATransform3D</span> <span class="n">transform</span> <span class="o">=</span> <span class="n">CATransform3DIdentity</span><span class="p">;</span>
</span><span class='line'>  <span class="n">CGFloat</span> <span class="n">verticalOffset</span> <span class="o">=</span> <span class="nb">self</span><span class="p">.</span><span class="n">bounds</span><span class="p">.</span><span class="n">size</span><span class="p">.</span><span class="n">height</span> <span class="o">+</span> <span class="mi">2</span><span class="p">;</span>
</span><span class='line'>  <span class="n">transform</span> <span class="o">=</span> <span class="n">CATransform3DTranslate</span><span class="p">(</span><span class="n">transform</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">verticalOffset</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
</span><span class='line'>  <span class="n">transform</span> <span class="o">=</span> <span class="n">CATransform3DScale</span><span class="p">(</span><span class="n">transform</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
</span><span class='line'>  <span class="n">layer</span><span class="p">.</span><span class="n">instanceTransform</span> <span class="o">=</span> <span class="n">transform</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>  <span class="c1">//reduce alpha of reflection layer</span>
</span><span class='line'>  <span class="n">layer</span><span class="p">.</span><span class="n">instanceAlphaOffset</span> <span class="o">=</span> <span class="o">-</span><span class="mf">0.6</span><span class="p">;</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="p">-</span> <span class="p">(</span><span class="kt">id</span><span class="p">)</span><span class="nf">initWithFrame:</span><span class="p">(</span><span class="bp">CGRect</span><span class="p">)</span><span class="nv">frame</span> <span class="p">{</span>
</span><span class='line'>  <span class="c1">//this is called when view is created in code</span>
</span><span class='line'>  <span class="k">if</span> <span class="p">((</span><span class="nb">self</span> <span class="o">=</span> <span class="p">[</span><span class="nb">super</span> <span class="nl">initWithFrame</span><span class="p">:</span><span class="n">frame</span><span class="p">]))</span> <span class="p">{</span>
</span><span class='line'>    <span class="p">[</span><span class="nb">self</span> <span class="n">setUp</span><span class="p">];</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'>  <span class="k">return</span> <span class="nb">self</span><span class="p">;</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<h3>CAScrollLayer</h3>

<p>用于绘制可以滑动的layer。</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
</pre></td><td class='code'><pre><code class='objective-c'><span class='line'><span class="p">+</span> <span class="p">(</span><span class="kt">Class</span><span class="p">)</span><span class="nf">layerClass</span> <span class="p">{</span>
</span><span class='line'>  <span class="k">return</span> <span class="p">[</span><span class="bp">CAScrollLayer</span> <span class="k">class</span><span class="p">];</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="p">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="nf">setUp</span> <span class="p">{</span>
</span><span class='line'>  <span class="c1">//enable clipping</span>
</span><span class='line'>  <span class="nb">self</span><span class="p">.</span><span class="n">layer</span><span class="p">.</span><span class="n">masksToBounds</span> <span class="o">=</span> <span class="nb">YES</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>  <span class="c1">//attach pan gesture recognizer</span>
</span><span class='line'>  <span class="bp">UIPanGestureRecognizer</span> <span class="o">*</span><span class="n">recognizer</span> <span class="o">=</span> <span class="nb">nil</span><span class="p">;</span>
</span><span class='line'>  <span class="n">recognizer</span> <span class="o">=</span> <span class="p">[[</span><span class="bp">UIPanGestureRecognizer</span> <span class="n">alloc</span><span class="p">]</span> <span class="nl">initWithTarget</span><span class="p">:</span><span class="nb">self</span> <span class="nl">action</span><span class="p">:</span><span class="k">@selector</span><span class="p">(</span><span class="nl">pan</span><span class="p">:)];</span>
</span><span class='line'>  <span class="p">[</span><span class="nb">self</span> <span class="nl">addGestureRecognizer</span><span class="p">:</span><span class="n">recognizer</span><span class="p">];</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="p">-</span> <span class="p">(</span><span class="kt">id</span><span class="p">)</span><span class="nf">initWithFrame:</span><span class="p">(</span><span class="bp">CGRect</span><span class="p">)</span><span class="nv">frame</span> <span class="p">{</span>
</span><span class='line'>  <span class="c1">//this is called when view is created in code</span>
</span><span class='line'>  <span class="k">if</span> <span class="p">((</span><span class="nb">self</span> <span class="o">=</span> <span class="p">[</span><span class="nb">super</span> <span class="nl">initWithFrame</span><span class="p">:</span><span class="n">frame</span><span class="p">]))</span> <span class="p">{</span>
</span><span class='line'>    <span class="p">[</span><span class="nb">self</span> <span class="n">setUp</span><span class="p">];</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'>  <span class="k">return</span> <span class="nb">self</span><span class="p">;</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="p">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="nf">pan:</span><span class="p">(</span><span class="bp">UIPanGestureRecognizer</span> <span class="o">*</span><span class="p">)</span><span class="nv">recognizer</span> <span class="p">{</span>
</span><span class='line'>  <span class="c1">//get the offset by subtracting the pan gesture</span>
</span><span class='line'>  <span class="c1">//translation from the current bounds origin</span>
</span><span class='line'>  <span class="bp">CGPoint</span> <span class="n">offset</span> <span class="o">=</span> <span class="nb">self</span><span class="p">.</span><span class="n">bounds</span><span class="p">.</span><span class="n">origin</span><span class="p">;</span>
</span><span class='line'>  <span class="n">offset</span><span class="p">.</span><span class="n">x</span> <span class="o">-=</span> <span class="p">[</span><span class="n">recognizer</span> <span class="nl">translationInView</span><span class="p">:</span><span class="nb">self</span><span class="p">].</span><span class="n">x</span><span class="p">;</span>
</span><span class='line'>  <span class="n">offset</span><span class="p">.</span><span class="n">y</span> <span class="o">-=</span> <span class="p">[</span><span class="n">recognizer</span> <span class="nl">translationInView</span><span class="p">:</span><span class="nb">self</span><span class="p">].</span><span class="n">y</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>  <span class="c1">//scroll the layer</span>
</span><span class='line'>  <span class="p">[(</span><span class="bp">CAScrollLayer</span> <span class="o">*</span><span class="p">)</span><span class="nb">self</span><span class="p">.</span><span class="n">layer</span> <span class="nl">scrollToPoint</span><span class="p">:</span><span class="n">offset</span><span class="p">];</span>
</span><span class='line'>
</span><span class='line'>  <span class="c1">//reset the pan gesture translation</span>
</span><span class='line'>  <span class="p">[</span><span class="n">recognizer</span> <span class="nl">setTranslation</span><span class="p">:</span><span class="n">CGPointZero</span> <span class="nl">inView</span><span class="p">:</span><span class="nb">self</span><span class="p">];</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<h3>CATiledLayer</h3>

<p>用于加载尺寸巨大的图片。</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
</pre></td><td class='code'><pre><code class='objective-c'><span class='line'><span class="c1">//add the tiled layer</span>
</span><span class='line'><span class="bp">CATiledLayer</span> <span class="o">*</span><span class="n">tileLayer</span> <span class="o">=</span> <span class="p">[</span><span class="bp">CATiledLayer</span> <span class="n">layer</span><span class="p">];</span>
</span><span class='line'><span class="n">tileLayer</span><span class="p">.</span><span class="n">frame</span> <span class="o">=</span> <span class="n">CGRectMake</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">2048</span><span class="p">,</span> <span class="mi">2048</span><span class="p">);</span>
</span><span class='line'><span class="n">tileLayer</span><span class="p">.</span><span class="n">delegate</span> <span class="o">=</span> <span class="nb">self</span><span class="p">;</span> <span class="p">[</span><span class="nb">self</span><span class="p">.</span><span class="n">scrollView</span><span class="p">.</span><span class="n">layer</span> <span class="nl">addSublayer</span><span class="p">:</span><span class="n">tileLayer</span><span class="p">];</span>
</span><span class='line'>
</span><span class='line'><span class="c1">//configure the scroll view</span>
</span><span class='line'><span class="nb">self</span><span class="p">.</span><span class="n">scrollView</span><span class="p">.</span><span class="n">contentSize</span> <span class="o">=</span> <span class="n">tileLayer</span><span class="p">.</span><span class="n">frame</span><span class="p">.</span><span class="n">size</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'><span class="c1">//draw layer</span>
</span><span class='line'><span class="p">[</span><span class="n">tileLayer</span> <span class="n">setNeedsDisplay</span><span class="p">];</span>
</span><span class='line'>
</span><span class='line'><span class="p">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="nf">drawLayer:</span><span class="p">(</span><span class="bp">CATiledLayer</span> <span class="o">*</span><span class="p">)</span><span class="nv">layer</span> <span class="nf">inContext:</span><span class="p">(</span><span class="n">CGContextRef</span><span class="p">)</span><span class="nv">ctx</span> <span class="p">{</span>
</span><span class='line'>  <span class="c1">//determine tile coordinate</span>
</span><span class='line'>  <span class="bp">CGRect</span> <span class="n">bounds</span> <span class="o">=</span> <span class="n">CGContextGetClipBoundingBox</span><span class="p">(</span><span class="n">ctx</span><span class="p">);</span>
</span><span class='line'>  <span class="bp">NSInteger</span> <span class="n">x</span> <span class="o">=</span> <span class="n">floor</span><span class="p">(</span><span class="n">bounds</span><span class="p">.</span><span class="n">origin</span><span class="p">.</span><span class="n">x</span> <span class="o">/</span> <span class="n">layer</span><span class="p">.</span><span class="n">tileSize</span><span class="p">.</span><span class="n">width</span><span class="p">);</span>
</span><span class='line'>  <span class="bp">NSInteger</span> <span class="n">y</span> <span class="o">=</span> <span class="n">floor</span><span class="p">(</span><span class="n">bounds</span><span class="p">.</span><span class="n">origin</span><span class="p">.</span><span class="n">y</span> <span class="o">/</span> <span class="n">layer</span><span class="p">.</span><span class="n">tileSize</span><span class="p">.</span><span class="n">height</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'>  <span class="c1">//load tile image</span>
</span><span class='line'>  <span class="bp">NSString</span> <span class="o">*</span><span class="n">imageName</span> <span class="o">=</span> <span class="p">[</span><span class="bp">NSString</span> <span class="nl">stringWithFormat</span><span class="p">:</span> <span class="s">@&quot;Snowman_%02i_%02i, x, y];</span>
</span><span class='line'>  <span class="bp">NSString</span> <span class="o">*</span><span class="n">imagePath</span> <span class="o">=</span> <span class="p">[[</span><span class="bp">NSBundle</span> <span class="n">mainBundle</span><span class="p">]</span> <span class="nl">pathForResource</span><span class="p">:</span><span class="n">imageName</span> <span class="nl">ofType</span><span class="p">:</span><span class="s">@&quot;jpg&quot;</span><span class="p">];</span>
</span><span class='line'>  <span class="bp">UIImage</span> <span class="o">*</span><span class="n">tileImage</span> <span class="o">=</span> <span class="p">[</span><span class="bp">UIImage</span> <span class="nl">imageWithContentsOfFile</span><span class="p">:</span><span class="n">imagePath</span><span class="p">];</span>
</span><span class='line'>
</span><span class='line'>  <span class="c1">//draw tile</span>
</span><span class='line'>  <span class="n">UIGraphicsPushContext</span><span class="p">(</span><span class="n">ctx</span><span class="p">);</span>
</span><span class='line'>  <span class="p">[</span><span class="n">tileImage</span> <span class="nl">drawInRect</span><span class="p">:</span><span class="n">bounds</span><span class="p">];</span>
</span><span class='line'>  <span class="n">UIGraphicsPopContext</span><span class="p">();</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<h3>CAEmitterLayer</h3>

<p>粒子特效。</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
</pre></td><td class='code'><pre><code class='objective-c'><span class='line'><span class="c1">//create particle emitter layer</span>
</span><span class='line'><span class="bp">CAEmitterLayer</span> <span class="o">*</span><span class="n">emitter</span> <span class="o">=</span> <span class="p">[</span><span class="bp">CAEmitterLayer</span> <span class="n">layer</span><span class="p">];</span>
</span><span class='line'><span class="n">emitter</span><span class="p">.</span><span class="n">frame</span> <span class="o">=</span> <span class="nb">self</span><span class="p">.</span><span class="n">containerView</span><span class="p">.</span><span class="n">bounds</span><span class="p">;</span>
</span><span class='line'><span class="p">[</span><span class="nb">self</span><span class="p">.</span><span class="n">containerView</span><span class="p">.</span><span class="n">layer</span> <span class="nl">addSublayer</span><span class="p">:</span><span class="n">emitter</span><span class="p">];</span>
</span><span class='line'>
</span><span class='line'><span class="c1">//configure emitter</span>
</span><span class='line'><span class="n">emitter</span><span class="p">.</span><span class="n">renderMode</span> <span class="o">=</span> <span class="n">kCAEmitterLayerAdditive</span><span class="p">;</span>
</span><span class='line'><span class="n">emitter</span><span class="p">.</span><span class="n">emitterPosition</span> <span class="o">=</span> <span class="n">CGPointMake</span><span class="p">(</span><span class="n">emitter</span><span class="p">.</span><span class="n">frame</span><span class="p">.</span><span class="n">size</span><span class="p">.</span><span class="n">width</span> <span class="o">/</span> <span class="mf">2.0</span><span class="p">,</span><span class="n">emitter</span><span class="p">.</span><span class="n">frame</span><span class="p">.</span><span class="n">size</span><span class="p">.</span><span class="n">height</span> <span class="o">/</span> <span class="mf">2.0</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'><span class="c1">//create a particle template</span>
</span><span class='line'><span class="bp">CAEmitterCell</span> <span class="o">*</span><span class="n">cell</span> <span class="o">=</span> <span class="p">[[</span><span class="bp">CAEmitterCell</span> <span class="n">alloc</span><span class="p">]</span> <span class="n">init</span><span class="p">];</span>
</span><span class='line'><span class="n">cell</span><span class="p">.</span><span class="n">contents</span> <span class="o">=</span> <span class="p">(</span><span class="k">__bridge</span> <span class="kt">id</span><span class="p">)[</span><span class="bp">UIImage</span> <span class="nl">imageNamed</span><span class="p">:</span><span class="s">@&quot;Spark.png&quot;</span><span class="p">].</span><span class="bp">CGImage</span><span class="p">;</span>
</span><span class='line'><span class="n">cell</span><span class="p">.</span><span class="n">birthRate</span> <span class="o">=</span> <span class="mi">150</span><span class="p">;</span>
</span><span class='line'><span class="n">cell</span><span class="p">.</span><span class="n">lifetime</span> <span class="o">=</span> <span class="mf">5.0</span><span class="p">;</span>
</span><span class='line'><span class="n">cell</span><span class="p">.</span><span class="n">color</span> <span class="o">=</span> <span class="p">[</span><span class="bp">UIColor</span> <span class="nl">colorWithRed</span><span class="p">:</span><span class="mi">1</span> <span class="nl">green</span><span class="p">:</span><span class="mf">0.5</span> <span class="nl">blue</span><span class="p">:</span><span class="mf">0.1</span> <span class="nl">alpha</span><span class="p">:</span><span class="mf">1.0</span><span class="p">].</span><span class="bp">CGColor</span><span class="p">;</span>
</span><span class='line'><span class="n">cell</span><span class="p">.</span><span class="n">alphaSpeed</span> <span class="o">=</span> <span class="o">-</span><span class="mf">0.4</span><span class="p">;</span>
</span><span class='line'><span class="n">cell</span><span class="p">.</span><span class="n">velocity</span> <span class="o">=</span> <span class="mi">50</span><span class="p">;</span>
</span><span class='line'><span class="n">cell</span><span class="p">.</span><span class="n">velocityRange</span> <span class="o">=</span> <span class="mi">50</span><span class="p">;</span>
</span><span class='line'><span class="n">cell</span><span class="p">.</span><span class="n">emissionRange</span> <span class="o">=</span> <span class="n">M_PI</span> <span class="o">*</span> <span class="mf">2.0</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'><span class="c1">//add particle template to emitter</span>
</span><span class='line'><span class="n">emitter</span><span class="p">.</span><span class="n">emitterCells</span> <span class="o">=</span> <span class="l">@[</span><span class="n">cell</span><span class="l">]</span><span class="p">;</span>
</span></code></pre></td></tr></table></div></figure>


<h3>AVPlayerLayer</h3>

<p>播放视频。</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
</pre></td><td class='code'><pre><code class='objective-c'><span class='line'><span class="c1">//get video URL</span>
</span><span class='line'><span class="bp">NSURL</span> <span class="o">*</span><span class="n">URL</span> <span class="o">=</span> <span class="p">[[</span><span class="bp">NSBundle</span> <span class="n">mainBundle</span><span class="p">]</span> <span class="nl">URLForResource</span><span class="p">:</span><span class="s">@&quot;Ship&quot;</span> <span class="nl">withExtension</span><span class="p">:</span><span class="s">@&quot;mp4&quot;</span><span class="p">];</span>
</span><span class='line'>
</span><span class='line'><span class="c1">//create player and player layer</span>
</span><span class='line'><span class="bp">AVPlayer</span> <span class="o">*</span><span class="n">player</span> <span class="o">=</span> <span class="p">[</span><span class="bp">AVPlayer</span> <span class="nl">playerWithURL</span><span class="p">:</span><span class="n">URL</span><span class="p">];</span>
</span><span class='line'><span class="bp">AVPlayerLayer</span> <span class="o">*</span><span class="n">playerLayer</span> <span class="o">=</span> <span class="p">[</span><span class="bp">AVPlayerLayer</span> <span class="nl">playerLayerWithPlayer</span><span class="p">:</span><span class="n">player</span><span class="p">];</span>
</span><span class='line'>
</span><span class='line'><span class="c1">//set player layer frame and attach it to our view</span>
</span><span class='line'><span class="n">playerLayer</span><span class="p">.</span><span class="n">frame</span> <span class="o">=</span> <span class="nb">self</span><span class="p">.</span><span class="n">containerView</span><span class="p">.</span><span class="n">bounds</span><span class="p">;</span>
</span><span class='line'><span class="p">[</span><span class="nb">self</span><span class="p">.</span><span class="n">containerView</span><span class="p">.</span><span class="n">layer</span> <span class="nl">addSublayer</span><span class="p">:</span><span class="n">playerLayer</span><span class="p">];</span>
</span><span class='line'>
</span><span class='line'><span class="c1">//play the video</span>
</span><span class='line'><span class="p">[</span><span class="n">player</span> <span class="n">play</span><span class="p">];</span>
</span></code></pre></td></tr></table></div></figure>


<h2>Implicit Animations</h2>

<p>隐式动画。改变支持动画的属性，自动生成动画。<br/>
duration -> transaction，默认为0.25秒<br/>
type -> layer action<br/>
transaction只能begin和commit。<br/>
每次runloop会执行一次transaction。</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
</pre></td><td class='code'><pre><code class='objective-c'><span class='line'><span class="c1">//begin a new transaction</span>
</span><span class='line'><span class="p">[</span><span class="bp">CATransaction</span> <span class="n">begin</span><span class="p">];</span>
</span><span class='line'>
</span><span class='line'><span class="c1">//set the animation duration to 1 second</span>
</span><span class='line'><span class="p">[</span><span class="bp">CATransaction</span> <span class="nl">setAnimationDuration</span><span class="p">:</span><span class="mf">1.0</span><span class="p">];</span>
</span><span class='line'>
</span><span class='line'><span class="c1">//add the spin animation on completion</span>
</span><span class='line'><span class="p">[</span><span class="bp">CATransaction</span> <span class="nl">setCompletionBlock</span><span class="p">:</span><span class="o">^</span><span class="p">{</span>
</span><span class='line'>  <span class="c1">//rotate the layer 90 degrees</span>
</span><span class='line'>  <span class="bp">CGAffineTransform</span> <span class="n">transform</span> <span class="o">=</span> <span class="nb">self</span><span class="p">.</span><span class="n">colorLayer</span><span class="p">.</span><span class="n">affineTransform</span><span class="p">;</span>
</span><span class='line'>  <span class="n">transform</span> <span class="o">=</span> <span class="n">CGAffineTransformRotate</span><span class="p">(</span><span class="n">transform</span><span class="p">,</span> <span class="n">M_PI_2</span><span class="p">);</span>
</span><span class='line'>  <span class="nb">self</span><span class="p">.</span><span class="n">colorLayer</span><span class="p">.</span><span class="n">affineTransform</span> <span class="o">=</span> <span class="n">transform</span><span class="p">;</span>
</span><span class='line'><span class="p">}];</span>
</span><span class='line'>
</span><span class='line'><span class="c1">//randomize the layer background color</span>
</span><span class='line'><span class="n">CGFloat</span> <span class="n">red</span> <span class="o">=</span> <span class="n">arc4random</span><span class="p">()</span> <span class="o">/</span> <span class="p">(</span><span class="n">CGFloat</span><span class="p">)</span><span class="n">INT_MAX</span><span class="p">;</span>
</span><span class='line'><span class="n">CGFloat</span> <span class="n">green</span> <span class="o">=</span> <span class="n">arc4random</span><span class="p">()</span> <span class="o">/</span> <span class="p">(</span><span class="n">CGFloat</span><span class="p">)</span><span class="n">INT_MAX</span><span class="p">;</span>
</span><span class='line'><span class="n">CGFloat</span> <span class="n">blue</span> <span class="o">=</span> <span class="n">arc4random</span><span class="p">()</span> <span class="o">/</span> <span class="p">(</span><span class="n">CGFloat</span><span class="p">)</span><span class="n">INT_MAX</span><span class="p">;</span>
</span><span class='line'><span class="nb">self</span><span class="p">.</span><span class="n">colorLayer</span><span class="p">.</span><span class="n">backgroundColor</span> <span class="o">=</span> <span class="p">[</span><span class="bp">UIColor</span> <span class="nl">colorWithRed</span><span class="p">:</span><span class="n">red</span> <span class="nl">green</span><span class="p">:</span><span class="n">green</span> <span class="nl">blue</span><span class="p">:</span><span class="n">blue</span> <span class="nl">alpha</span><span class="p">:</span><span class="mf">1.0</span><span class="p">].</span><span class="bp">CGColor</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'><span class="c1">//commit the transaction</span>
</span><span class='line'><span class="p">[</span><span class="bp">CATransaction</span> <span class="n">commit</span><span class="p">];</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>隐式动画流程：<br/>
-actionForLayer:forKey<br/>
actions dictionary<br/>
style dictionary<br/>
-defaultActionForKey:</p>

<p>UIView默认不开启隐式动画。<br/>
CATransition</p>

<p>修改layer属性会立即生效，但是并不会立刻显示。</p>

<p>presentation layer，记录当前layer在哪儿，同步动画和处理点击事件。<br/>
model layer，记录当前layer要去哪儿</p>

<h2>Explicit Aniamtions</h2>

<p>显式动画。</p>

<h3>Property Animations</h3>

<p>只与一个属性相关的动画。</p>

<p>CABasicAnimation : CAPropertyAnimation : CAAnimation<br/>
fromeValue<br/>
toValue<br/>
byValue</p>

<p>Animations只作用于presentation，而不作用于model。</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
</pre></td><td class='code'><pre><code class='objective-c'><span class='line'><span class="p">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="nf">applyBasicAnimation:</span><span class="p">(</span><span class="bp">CABasicAnimation</span> <span class="o">*</span><span class="p">)</span><span class="nv">animation</span> <span class="nf">toLayer:</span><span class="p">(</span><span class="bp">CALayer</span> <span class="o">*</span><span class="p">)</span><span class="nv">layer</span><span class="p">{</span>
</span><span class='line'>  <span class="c1">//set the from value (using presentation layer if available)  </span>
</span><span class='line'>  <span class="n">animation</span><span class="p">.</span><span class="n">fromValue</span> <span class="o">=</span> <span class="p">[</span><span class="n">layer</span><span class="p">.</span><span class="n">presentationLayer</span> <span class="o">?:</span> <span class="n">layer</span> <span class="nl">valueForKeyPath</span><span class="p">:</span><span class="n">animation</span><span class="p">.</span><span class="n">keyPath</span><span class="p">];</span>
</span><span class='line'>
</span><span class='line'>  <span class="c1">//update the property in advance</span>
</span><span class='line'>  <span class="c1">//note: this approach will only work if toValue != nil</span>
</span><span class='line'>  <span class="p">[</span><span class="bp">CATransaction</span> <span class="n">begin</span><span class="p">];</span>
</span><span class='line'>  <span class="p">[</span><span class="bp">CATransaction</span> <span class="nl">setDisableActions</span><span class="p">:</span><span class="nb">YES</span><span class="p">];</span>
</span><span class='line'>  <span class="p">[</span><span class="n">layer</span> <span class="nl">setValue</span><span class="p">:</span><span class="n">animation</span><span class="p">.</span><span class="n">toValue</span> <span class="nl">forKeyPath</span><span class="p">:</span><span class="n">animation</span><span class="p">.</span><span class="n">keyPath</span><span class="p">];</span>
</span><span class='line'>  <span class="p">[</span><span class="bp">CATransaction</span> <span class="n">commit</span><span class="p">];</span>
</span><span class='line'>
</span><span class='line'>  <span class="c1">//apply animation to layer</span>
</span><span class='line'>  <span class="p">[</span><span class="n">layer</span> <span class="nl">addAnimation</span><span class="p">:</span><span class="n">animation</span> <span class="nl">forKey</span><span class="p">:</span><span class="nb">nil</span><span class="p">];</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>CAKeyframeAnimation : CAPropertyAnimation : CAAnimation<br/>
values<br/>
path<br/>
rotationMode = kCAAnimationRotateAuto</p>

<p>CAAnimationGroup<br/>
animations<br/>
duration</p>

<p>Transitions<br/>
CATransition : CAAnimation<br/>
type<br/>
subtype</p>

<p>视图控制器切换时使用，效果更平滑；</p>

<h3>Cancel animations</h3>

<p><code>-removeAnimationForKey: </code></p>

<h2>Layer time</h2>

<h2>Tuning for speed</h2>

<p>合理分配绘图任务至CPU和GPU。</p>

<h3>The Stages of an Animation</h3>

<p>Layout：setup layers<br/>
Display：draw backing image，call -drawRect:<br/>
Prepare：prepare send animation data to render server<br/>
Commit：package up and send over IPC<br/>
render server form render tree:<br/>
  calculate intermediate values<br/>
  render to screen<br/>
只有最后一步通过GPU处理。<br/>
开发者只能控制前两步，layout和display。</p>

<p>影响GPU绘图效率的因素：<br/>
1、过多的layer；<br/>
2、过多的半透明layer；<br/>
3、离屏绘制，如圆角、遮罩、阴影、光栅化；<br/>
4、过大的图片。</p>

<p>影响CPU绘图效率的因素：<br/>
1、复杂的layout计算；<br/>
2、view的懒加载，从数据库获取数据，从nib中加载view，加载图片；<br/>
3、Core Graphics 绘图；<br/>
4、图片解压缩；</p>

<p>IO限制因素：<br/>
IO操作耗时严重；</p>

<p>通过测量发现实际的瓶颈点：<br/>
1、在真机上测试，使用release版本，在低性能机器上测试；<br/>
2、保持稳定的帧率；<br/>
3、instrument：</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
</pre></td><td class='code'><pre><code class='objective-c'><span class='line'><span class="n">Time</span> <span class="n">Profiler</span><span class="err">：查看</span><span class="n">CPU</span><span class="err">时间开销；</span>
</span><span class='line'>    <span class="n">Separate</span> <span class="n">by</span> <span class="n">Thread</span><span class="err">：按线程将方法分组；</span>
</span><span class='line'>    <span class="n">Hide</span> <span class="n">System</span> <span class="n">Libraries</span><span class="err">：隐藏系统库；</span>
</span><span class='line'>    <span class="n">Show</span> <span class="n">Obj</span><span class="o">-</span><span class="n">C</span> <span class="n">Only</span><span class="err">：只显示</span><span class="n">OC</span><span class="err">方法调用；</span>
</span><span class='line'><span class="n">Core</span> <span class="n">Animation</span><span class="err">：查看</span><span class="n">Core</span> <span class="n">Animation</span><span class="err">性能；</span>
</span><span class='line'>    <span class="n">Color</span> <span class="n">Blended</span> <span class="n">Layers</span><span class="err">：标记出混合的图层，从绿到红表示严重程度，最好没有；</span>
</span><span class='line'>    <span class="n">Color</span> <span class="n">Hits</span> <span class="n">Green</span> <span class="n">and</span> <span class="n">Misses</span> <span class="n">Red</span><span class="err">：标记出重复缓存的图层；</span>
</span><span class='line'>    <span class="n">Color</span> <span class="n">Copied</span> <span class="n">Images</span><span class="err">：标记出</span><span class="n">backing</span> <span class="n">image</span><span class="err">，最好没有；</span>
</span><span class='line'>    <span class="n">Color</span> <span class="n">Immediately</span><span class="err">：随时反馈；</span>
</span><span class='line'>    <span class="n">Color</span> <span class="n">Misaligned</span> <span class="n">Images</span><span class="err">：标记非正确缩放的图片；</span>
</span><span class='line'>    <span class="n">Color</span> <span class="n">Offscreen</span><span class="o">-</span><span class="n">Rendered</span> <span class="n">Yellow</span><span class="err">：标记出需要离屏绘制的</span><span class="n">layer</span><span class="err">，通过栅格化优化；</span>
</span><span class='line'>    <span class="n">Color</span> <span class="n">OpenGL</span> <span class="n">Fast</span> <span class="n">Path</span> <span class="n">Blue</span><span class="err">：标记出</span><span class="n">OpenGL</span><span class="err">绘图；</span>
</span><span class='line'>    <span class="n">Flash</span> <span class="n">Updated</span> <span class="n">Regions</span><span class="err">：标记出重绘的</span><span class="n">layer</span><span class="err">，最好没有；</span>
</span><span class='line'><span class="n">OpenGL</span> <span class="n">ES</span> <span class="n">Driver</span><span class="err">：查看</span><span class="n">GPU</span><span class="err">性能；</span>
</span><span class='line'>    <span class="n">Tiler</span> <span class="n">Utilization</span>
</span><span class='line'>    <span class="n">Renderer</span> <span class="n">Utilization</span>
</span><span class='line'><span class="err">组合使用效果更佳。</span>
</span></code></pre></td></tr></table></div></figure>


<p>优化方法：<br/>
cache offscreen render layer：</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='objective-c'><span class='line'><span class="n">layer</span><span class="p">.</span><span class="n">shouldRasterize</span> <span class="o">=</span> <span class="nb">YES</span><span class="p">;</span>
</span><span class='line'><span class="n">layer</span><span class="p">.</span><span class="n">rasterizationScale</span> <span class="o">=</span> <span class="p">[</span><span class="bp">UIScreen</span> <span class="n">mainScreen</span><span class="p">].</span><span class="n">scale</span><span class="p">;</span>
</span></code></pre></td></tr></table></div></figure>


<h2>Efficient Drawing</h2>

<h3>Software Drawing</h3>

<p>速度慢并且需要大量内存空间。<br/>
少写drawRect方法。</p>

<h3>Vector Graphics</h3>

<p>多边形；<br/>
对角线和曲线；<br/>
文字；<br/>
渐变。<br/>
使用CAShapeLayer</p>

<h3>Dirty Rectangles</h3>

<p>需要重绘的区域<br/>
调用-setNeedsDisplayInRect:方法指定重绘区域。</p>

<h3>Asynchronous Drawing</h3>

<p>在子线程绘图，将结果直接作为layer的contents。<br/>
CATiledLayer。<br/>
drawsAsynchronously属性。</p>

<h2>Image IO</h2>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class='objective-c'><span class='line'><span class="c1">//  通过tag防止重复创建</span>
</span><span class='line'><span class="bp">UIImageView</span> <span class="o">*</span><span class="n">imageView</span> <span class="o">=</span> <span class="p">(</span><span class="bp">UIImageView</span> <span class="o">*</span><span class="p">)[</span><span class="n">cell</span> <span class="nl">viewWithTag</span><span class="p">:</span><span class="n">imageTag</span><span class="p">];</span>
</span><span class='line'><span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">imageView</span><span class="p">){</span>
</span><span class='line'>  <span class="n">imageView</span> <span class="o">=</span> <span class="p">[</span><span class="bp">UIImageView</span> <span class="n">alloc</span><span class="p">]</span> <span class="n">init</span><span class="p">];</span>
</span><span class='line'>  <span class="p">[</span><span class="n">cell</span><span class="p">.</span><span class="n">contentView</span> <span class="nl">addSubview</span><span class="p">:</span><span class="n">imageView</span><span class="p">];</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<h3>Loading and Latency</h3>

<p>button的响应时间要保持在0.2秒以下。</p>

<h3>Threaded Loading</h3>

<p>gcd</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
</pre></td><td class='code'><pre><code class='objective-c'><span class='line'><span class="c1">//  标记cell</span>
</span><span class='line'><span class="n">cell</span><span class="p">.</span><span class="n">tag</span> <span class="o">=</span> <span class="n">indexPath</span><span class="p">.</span><span class="n">row</span><span class="p">;</span>
</span><span class='line'><span class="n">imageView</span><span class="p">.</span><span class="n">image</span> <span class="o">=</span> <span class="nb">nil</span><span class="p">;</span>
</span><span class='line'><span class="c1">//  异步加载图片</span>
</span><span class='line'><span class="n">dispatch_aysnc</span><span class="p">(</span><span class="n">dispatch_get_global_queue</span><span class="p">(</span><span class="n">DISPATCH_QUEUE_PRIORITY_LOW</span><span class="p">),</span><span class="mi">0</span><span class="p">),</span><span class="o">^</span><span class="p">{</span>
</span><span class='line'>  <span class="c1">//  加载图片</span>
</span><span class='line'>  <span class="bp">NSInteger</span> <span class="n">index</span> <span class="o">=</span> <span class="n">indexPath</span><span class="p">.</span><span class="n">row</span><span class="p">;</span>
</span><span class='line'>  <span class="bp">NSString</span> <span class="o">*</span><span class="n">imagePath</span> <span class="o">=</span> <span class="nb">self</span><span class="p">.</span><span class="n">imagePaths</span><span class="p">[</span><span class="n">index</span><span class="p">];</span>
</span><span class='line'>  <span class="bp">UIImageView</span> <span class="o">*</span><span class="n">image</span> <span class="o">=</span> <span class="p">[</span><span class="bp">UIImage</span> <span class="nl">imageWithContentsOfFile</span><span class="p">:</span><span class="n">imagePath</span><span class="p">];</span>
</span><span class='line'>
</span><span class='line'>  <span class="c1">//  在主线程显示图片</span>
</span><span class='line'>  <span class="n">dispatch_async</span><span class="p">(</span><span class="n">dispatch_get_main_queue</span><span class="p">(),</span><span class="o">^</span><span class="p">{</span>
</span><span class='line'>    <span class="k">if</span> <span class="p">(</span><span class="n">index</span> <span class="o">==</span> <span class="n">cell</span><span class="p">.</span><span class="n">tag</span><span class="p">){</span>
</span><span class='line'>      <span class="n">imageView</span><span class="p">.</span><span class="n">image</span> <span class="o">=</span> <span class="n">image</span><span class="p">;</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>  <span class="p">});</span>
</span><span class='line'><span class="p">});</span>
</span></code></pre></td></tr></table></div></figure>


<h3>Deferred Decompression</h3>

<p>PNG图片大，但解压快；<br/>
JPEG图片小，但解压慢。<br/>
图片通常在需要绘制前才开始解压。<br/>
[UIImage imageWithName:imageName] 该方法载入图片后即开始解压。<br/>
layer的contents或UIImageView的image。<br/>
ImageIO.framework</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class='objective-c'><span class='line'><span class="bp">NSInteger</span> <span class="n">index</span> <span class="o">=</span> <span class="n">indexPath</span><span class="p">.</span><span class="n">row</span><span class="p">;</span>
</span><span class='line'><span class="bp">NSURL</span> <span class="o">*</span><span class="n">imageURL</span> <span class="o">=</span> <span class="p">[</span><span class="bp">NSURL</span> <span class="nl">fileURLWithPath</span><span class="p">:</span><span class="nb">self</span><span class="p">.</span><span class="n">imagePaths</span><span class="p">[</span><span class="n">index</span><span class="p">]];</span>
</span><span class='line'><span class="bp">NSDictionary</span> <span class="o">*</span><span class="n">options</span> <span class="o">=</span> <span class="l">@{</span><span class="p">(</span><span class="k">__bridge</span> <span class="kt">id</span><span class="p">)</span><span class="nl">kCGImageSourceShouldCache</span><span class="p">:</span><span class="m">@YES</span><span class="l">}</span><span class="p">;</span>
</span><span class='line'><span class="n">CGImageSourceRef</span> <span class="n">source</span> <span class="o">=</span> <span class="n">CGImageSourceCreateWithURL</span><span class="p">((</span><span class="k">__bridge</span> <span class="n">CFURLRef</span><span class="p">)</span><span class="n">imageURL</span><span class="p">,</span><span class="nb">NULL</span><span class="p">);</span>
</span><span class='line'><span class="n">CGImageRef</span> <span class="n">imageRef</span> <span class="o">=</span> <span class="n">CGImageSourceCreateImageAtIndex</span><span class="p">(</span><span class="n">source</span><span class="p">,</span><span class="mi">0</span><span class="p">,(</span><span class="k">__bridge</span> <span class="n">CFDictionaryRef</span><span class="p">)</span><span class="n">options</span><span class="p">);</span>
</span><span class='line'><span class="bp">UIImage</span> <span class="o">*</span><span class="n">image</span> <span class="o">=</span> <span class="p">[</span><span class="bp">UIImage</span> <span class="nl">imageWithCGImage</span><span class="p">:</span><span class="n">imageRef</span><span class="p">];</span>
</span><span class='line'><span class="n">CGImageRelease</span><span class="p">(</span><span class="n">imageRef</span><span class="p">);</span>
</span><span class='line'><span class="n">CFRelease</span><span class="p">(</span><span class="n">source</span><span class="p">);</span>
</span></code></pre></td></tr></table></div></figure>


<p>NSCache</p>

<h2>Layer Performance</h2>

<p class='post-footer'>
  原始地址：
  <a href='http://sxgfxm.github.io/blog/2017/02/20/ios-core-animation-advanced-techniques/'>http://sxgfxm.github.io/blog/2017/02/20/ios-core-animation-advanced-techniques/</a><br/>
  written by <a href='http://sxgfxm.github.io'>Light</a>
  &nbsp;posted at <a href='http://sxgfxm.github.io'>http://sxgfxm.github.io</a>
  </p>

</div>


  <footer>
    <p class="meta">
      
  

<span class="byline author vcard">Posted by <span class="fn">Light</span></span>

      




<time class='entry-date' datetime='2017-02-20T22:10:40+08:00'><span class='date'><span class='date-month'>Feb</span> <span class='date-day'>20</span><span class='date-suffix'>th</span>, <span class='date-year'>2017</span></span> <span class='time'>10:10 pm</span></time>
      

<span class="categories">
  
    <a class='category' href='/blog/categories/ios/'>ios</a>
  
</span>


    </p>
    
      <div class="sharing">
  
  
  
  
</div>

    
    <p class="meta">
      
        <a class="basic-alignment left" href="/blog/2017/02/10/export-music-from-itunes-to-local-apps-sandbox-on-iphone/" title="Previous Post: Export Music from Itunes to Local App's Sandbox on iPhone">&laquo; Export Music from Itunes to Local App's Sandbox on iPhone</a>
      
      
        <a class="basic-alignment right" href="/blog/2017/02/25/ios-system-authorization/" title="Next Post: iOS System Authorization">iOS System Authorization &raquo;</a>
      
    </p>
  </footer>
</article>

  <section>
    <h1>Comments</h1>
    <div id="disqus_thread" aria-live="polite"><noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
</div>
  </section>

</div>

<aside class="sidebar">
  
    <section>
 <h1>Introduction</h1>

<li>
	<span style="color:#222222;font-family:inherit;font-size:18px;font-style:inherit;font-weight:inherit;line-height:1.5;">Light</br></span>
	<span style="font-family:inherit;font-style:inherit;font-weight:inherit;color:#222222;font-size:18px;line-height:1.5;">iOS研发工程师</br></span>
	<span style="font-family:inherit;font-style:inherit;font-weight:inherit;color:#222222;font-size:18px;line-height:1.5;">现就职于 出门问问</br></span>
  <span style="font-family:inherit;font-style:inherit;font-weight:inherit;color:#222222;font-size:18px;line-height:1.5;">E-mail: aysxgfxm@163.com</br></span>
</li>

</section>
<section>
 <h1>Categories</h1>
 <ul id="categories">
  <li class='category'><a href='/blog/categories/componentkit/'>componentkit (1)</a></li>
<li class='category'><a href='/blog/categories/ios/'>ios (56)</a></li>
<li class='category'><a href='/blog/categories/markdown/'>markdown (1)</a></li>
<li class='category'><a href='/blog/categories/octopress/'>octopress (3)</a></li>
<li class='category'><a href='/blog/categories/reactiveobjc/'>reactiveobjc (2)</a></li>

 </ul>
</section><section>
  <h1>Recent Posts</h1>
  <ul id="recent_posts">
    
      <li class="post">
        <a href="/blog/2018/03/18/ioszhi-shi-xiao-ji-180312/">iOS知识小集-180312</a>
      </li>
    
      <li class="post">
        <a href="/blog/2018/03/12/ioszhi-shi-xiao-ji-180129/">iOS知识小集-180129</a>
      </li>
    
      <li class="post">
        <a href="/blog/2018/03/12/ioszhi-shi-xiao-ji-171211/">iOS知识小集-171211</a>
      </li>
    
      <li class="post">
        <a href="/blog/2017/12/11/ioszhi-shi-xiao-ji-171204/">iOS知识小集-171204</a>
      </li>
    
      <li class="post">
        <a href="/blog/2017/12/02/ioszhi-shi-xiao-ji-171127/">iOS知识小集-171127</a>
      </li>
    
  </ul>
</section>
<section>
 <h1>他山之石</h1>
	<li>
		<a href="http://southpeak.github.io/">南峰子的技术博客</a></br>
	</li>
	<li>
		<a href="http://www.tutorialspoint.com/index.htm">TutorailSpoint</a></br>
	</li>
	<li>
		<a href="http://stackoverflow.com/">StackOverflow</a></br>
	</li>
</section>
<section>
  <h1>GitHub Repos</h1>
  <ul id="gh_repos">
    <li class="loading">Status updating...</li>
  </ul>
  
  <a href="https://github.com/sxgfxm">@sxgfxm</a> on GitHub
  
  <script type="text/javascript">
    $(document).ready(function(){
        if (!window.jXHR){
            var jxhr = document.createElement('script');
            jxhr.type = 'text/javascript';
            jxhr.src = '/javascripts/libs/jXHR.js';
            var s = document.getElementsByTagName('script')[0];
            s.parentNode.insertBefore(jxhr, s);
        }

        github.showRepos({
            user: 'sxgfxm',
            count: 5,
            skip_forks: true,
            target: '#gh_repos'
        });
    });
  </script>
  <script src="/javascripts/github.js" type="text/javascript"> </script>
</section>




<section>
 <h1>Visitors</h1>
	<a href="http://info.flagcounter.com/CVgH"><img src="http://s09.flagcounter.com/count2/CVgH/bg_FFFFFF/txt_000000/border_CCCCCC/columns_2/maxflags_10/viewers_0/labels_0/pageviews_0/flags_0/percent_0/" alt="Flag Counter" border="0"></a>
</section>
  
</aside>


    </div>
  </div>
  <footer role="contentinfo"><p>
  Copyright &copy; 2018 - Light -
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span>
</p>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-86198628-1', 'auto');
  ga('send', 'pageview');

</script>

</footer>
  

<script type="text/javascript">
      var disqus_shortname = 'lights-blog';
      
        
        // var disqus_developer = 1;
        var disqus_identifier = 'http://sxgfxm.github.io/blog/2017/02/20/ios-core-animation-advanced-techniques/';
        var disqus_url = 'http://sxgfxm.github.io/blog/2017/02/20/ios-core-animation-advanced-techniques/';
        var disqus_script = 'embed.js';
      
    (function () {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = '//' + disqus_shortname + '.disqus.com/' + disqus_script;
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    }());
</script>











</body>
</html>
